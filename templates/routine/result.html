{% extends 'base.html' %}

{% block content %}
<div class="routine-dashboard">
    <aside class="styled-sidebar">
        <h2 class="sidebar-title">Routine</h2>
        <a href="{{ url_for('main.dashboard') }}" class="nav-btn">Dashboard</a>
        <a href="{{ url_for('goal.view_goals') }}" class="nav-btn">Goals</a>
        <a href="{{ url_for('routine.routine_input') }}" class="nav-btn">Generate New</a>
        <a href="{{ url_for('auth.logout') }}" class="nav-btn">Logout</a>
    </aside>
    

    <main class="routine-main">
        <header class="routine-header">
            <h2>Your Suggested Routine</h2>
            <p class="routine-desc">Weekly breakdown based on your fitness goal</p>
        </header>

        {% if sample %}
        <div class="routine-grid-cards" id="routine-container">
            {% for day, time, activity in sample %}
            <div class="routine-box-card" id="card-{{ loop.index0 }}">
                <h4>{{ day }} – {{ time }}</h4>
                <p id="activity-{{ loop.index0 }}">{{ activity }}</p>
                <button class="secondary-btn" onclick="enableEdit({{ loop.index0 }})">Edit</button>
                <button class="secondary-btn" onclick="deleteCard({{ loop.index0 }})">Delete</button>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No routine generated yet.</p>
        {% endif %}

        <div class="routine-box" style="margin-top: 40px;">
            <h3><strong>Current Entries</strong></h3>
            <div id="summary-list">
                {% for day, time, activity in sample %}
                <p id="summary-{{ loop.index0 }}"><strong>{{ day }}</strong> - {{ time }} → {{ activity }}</p>
                {% endfor %}
            </div>
            <a href="{{ url_for('main.dashboard') }}" class="back-dashboard-btn">Back to dashboard</a>
        </div>
    </main>
</div>


<script>
function enableEdit(index) {
    const activityPara = document.getElementById(`activity-${index}`);
    const oldText = activityPara.innerText;

    const input = document.createElement('input');
    input.type = 'text';
    input.value = oldText;
    input.className = 'form-input';
    input.id = `edit-input-${index}`;

    const saveBtn = document.createElement('button');
    saveBtn.innerText = 'Save';
    saveBtn.className = 'secondary-btn';
    saveBtn.onclick = () => {
        const newActivity = input.value;
        fetch('/routine/update_entry', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ index, new_activity: newActivity })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                activityPara.innerText = newActivity;
                document.getElementById(`summary-${index}`).innerText = `${document.querySelector(`#card-${index} h4`).innerText} → ${newActivity}`;
                activityPara.style.display = 'block';
                wrapper.remove();
            }
        });
    };

    const wrapper = document.createElement('div');
    wrapper.appendChild(input);
    wrapper.appendChild(saveBtn);

    activityPara.style.display = 'none';
    activityPara.parentElement.appendChild(wrapper);
}

function deleteCard(index) {
    fetch('/routine/delete_entry', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ index })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            document.getElementById(`card-${index}`).remove();
            document.getElementById(`summary-${index}`).remove();
        }
    });
}
</script>
{% endblock %}
