{% extends 'base.html' %}

{% block content %}
<div class="routine-dashboard">
    <aside class="routine-sidebar">
        <h2>Routine</h2>
        <ul>
            <li><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
            <li><a href="{{ url_for('goal.view_goals') }}">Goals</a></li>
            <li><a href="{{ url_for('routine.routine_input') }}">Generate New</a></li>
            <li><a href="{{ url_for('auth.logout') }}">Logout</a></li>
        </ul>
    </aside>

    <main class="routine-main">
        <header class="routine-header">
            <h2>Your Suggested Routine</h2>
            <p class="routine-desc">Weekly breakdown based on your fitness goal</p>
        </header>

        {% if sample %}
        <div class="routine-grid-cards">
            {% for day, time, activity in sample %}
            <div class="routine-box-card" id="card-{{ loop.index0 }}">
                <h4>{{ day }} – {{ time }}</h4>
                <p id="activity-{{ loop.index0 }}">{{ activity }}</p>
                <button class="secondary-btn" onclick="enableEdit('{{ loop.index0 }}')">Edit</button>
                <button class="secondary-btn" onclick="deleteCard('{{ loop.index0 }}')">Delete</button>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No routine generated yet.</p>
        {% endif %}

        <!-- Current Entries Summary -->
        <div class="routine-box" style="margin-top: 40px;">
            <h3><strong>Current Entries</strong></h3>
            {% for day, time, activity in sample %}
            <p><strong>{{ day }}</strong> - {{ time }} → {{ activity }}</p>
            {% endfor %}
            <a href="{{ url_for('main.dashboard') }}" class="secondary-btn">Finish & View Routine</a>
        </div>
    </main>
</div>

<script>
    function enableEdit(index) {
        const activityPara = document.getElementById(`activity-${index}`);
        const oldText = activityPara.innerText;
    
        const newInput = document.createElement('input');
        newInput.type = 'text';
        newInput.value = oldText;
        newInput.id = `edit-input-${index}`;
        newInput.className = 'form-input';
    
        const saveBtn = document.createElement('button');
        saveBtn.innerText = 'Save';
        saveBtn.className = 'secondary-btn';
        saveBtn.onclick = function () {
            const updated = newInput.value;
            fetch('/routine/update_entry', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ index, new_activity: updated })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    activityPara.innerText = updated;
                    activityPara.style.display = 'block';
                    inputWrapper.remove();
                }
            });
        };
    
        const inputWrapper = document.createElement('div');
        inputWrapper.appendChild(newInput);
        inputWrapper.appendChild(saveBtn);
    
        activityPara.style.display = 'none';
        document.getElementById(`card-${index}`).appendChild(inputWrapper);
    }
    
    function deleteCard(index) {
        fetch('/routine/delete_entry', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ index })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                const card = document.getElementById(`card-${index}`);
                if (card) card.remove();
            }
        });
    }
    </script>
    
{% endblock %}
